<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-language" content="en">
    <meta property="og:locale" content="en_US">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
    <!-- <meta property="og:image:width" content="750"> -->
    <!-- <meta property="og:image:height" content="500"> -->
    <meta property="og:image:type" content="image/png">
    <!-- <meta name="twitter:card" content="summary_large_image"> -->
    <!-- <link rel="icon" type="image/x-icon" href="https://addsoupbase.github.io/cute-emojis/emojis/1275614660187521064.gif" defer> -->
    <meta name="robots" content="index">
    <meta name="color-scheme" content="normal">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="../cute-green.css">
    <meta name="twitter:creator" content="addsoupbase">
    <meta name="author" content="addsoupbase">
    <meta property="profile:username" content="addsoupbase">
    <meta property="og:url" content="https://addsoupbase.github.io/textshortener/">
    <meta name="twitter:url" content="https://addsoupbase.github.io/textshortener/">
    <link rel="canonical" href="https://addsoupbase.github.io/textshortener/">
    <meta property="og:description" content="Shorten your text">
    <meta name="description" content="Shorten your text">
    <meta name="twitter:description" content="Shorten your text">
    <meta property="og:title" content="Text Shortener">
    <meta name="twitter:title" content="Text Shortener">
    <meta property="og:site_name" content="Text Shortener">
    <meta property="og:image" content="https://addsoupbase.github.io/cute-emojis/emojis/1275614660187521064.gif">
    <meta name="twitter:image" content="https://addsoupbase.github.io/cute-emojis/emojis/1275614660187521064.gif">
    <script src="../css.js" blocking="render"></script>
    <script src="../css_bad.js" nomodule></script>
    <title>Text Shortener</title>
</head>
<style>
    @charset "UTF-8";
    @import url('../chococooky.css');

    #c {
        font-size: xx-large;
        font-family: 'Choco';
        width: 500px;
        max-width: 100vw;
        height: fit-content;
    }

    textarea {
        font-size: large;
        max-width: 100%;
        --word-wrap: break-word;
        word-break: break-all;
    }

    textarea {
        font-family: monospace;
        font-variant-emoji: unicode;
    }

    #help {
        cursor: help;
        --tap-highlight-color: rgba(48, 119, 190, 0.5);
        --user-select: none;
    }
</style>

<body style="background-color: #919191;">
    <form id="c" class="center cute-green">
        <p id="saved">Saving 0 characters</p>
        <textarea placeholder="Your text goes here" id="txt" name="txt" required rows="5"></textarea>
        <div style="display: grid;margin:5px">
            <!-- <textarea id="output" placeholder="Shortened text is here" readonly></textarea> -->
            <input type="button" class="cute-green-button" id="paste" value="Paste text">
            <button class="cute-green-button">Copy Shortened text</button>
        </div>
        <a id="help" href="./whatisthis.html">what is this?</a>
    </form>
    <script>
        'use strict'
        window.onerror = function (e) {
            console.log(e)
            if (/syntax/i.test(e)) {
                window.onerror=null
                syncImport('../h.js')
                syncImport('ie.js')
            }
            function syncImport(src) {
                var n = new XMLHttpRequest,
                    x = eval
                n.open('GET', src, !1)
                n.send()
                var res = n.getResponseHeader('Content-Type')
                if (/(?:text|application)\/(?:x-)?(?:j(?:ava)?|ecma|live)script(?:1\.[0-5])?/.test(res) && n.status === 'OK' || n.status === 200) return x(n.responseText)
                throw TypeError('Failed to load script')
            }
        }
    </script>
    <script type="module">
        import $ from '../yay.js'
        import { plural } from '../str.js'
        import { jason } from '../arrays.js'
        $.byId.paste.on({
            async click() {
                let t
                try {
                    t = await navigator.clipboard.readText()
                }
                catch {
                    t = prompt('Paste text:')
                }
                finally {
                    txt.value = t
                    txt.dispatchEvent(new Event('input'))
                }
            }
        })
        let { saved } = $.byId
        let text = txt.value
        $.byId.txt.on({
            input() {
                text = shortenText(this.value)
                let val = this.value.length - text.length
                saved.textContent = `Saving ${plural('character', 'characters', val)}`
            }
        })
        $.byId.c.on({
            async $submit() {

                try {
                    await navigator.clipboard.writeText(text)
                }
                catch {
                    prompt('Shortened text:', text)
                }
                finally {
                    console.log(text)
                }
            }
        })
        let abc = 'abcdefghijklmnopqrstuvwxyz'
        let aa= await jason('./subs.json')
        const substitutes = (aa)
        .map(([a, b]) => [RegExp(a, 'g'), b]).sort(([a], [b]) => b.source.replaceAll('\\', '').normalize().length - a.source.replaceAll('\\', '').normalize().length)
        console.log(substitutes)
        // These ones look weird on my device so
        // ; ((nums) => {
        // let numbers = [...'123456789', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20']
        // for (let i = 0; i < nums.length; i++) {
        // let r = RegExp(`${numbers[i]}\,`, 'g')
        // let str = nums[i]
        // substitutes.push([r, str])
        // }
        // })('ðŸ„‚ðŸ„ƒðŸ„„ðŸ„…ðŸ„†ðŸ„‡ðŸ„ˆðŸ„‰ðŸ„Š');
        debugger
        function shortenText(og) {
            let text = og
            substitutes.forEach(({ 0: regex, 1: replacement }) => {
                text = text.replace(regex, replacement)
            })
            return text
        }
        
    </script>

    <script nomodule src="../h.js"></script>
    <script nomodule src="ie.js"></script>
</body>

</html>